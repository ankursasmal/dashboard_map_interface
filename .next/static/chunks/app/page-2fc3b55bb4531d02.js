(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3685:function(e,t,l){Promise.resolve().then(l.bind(l,5282))},5282:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return _}});var a=l(7437),o=l(2265),r=l(7818),n=l(2513),s=l(6129);let i=[{id:"temperature_2m",label:"Temperature (2m)",unit:"\xb0C",apiField:"temperature_2m"},{id:"relative_humidity_2m",label:"Relative Humidity (2m)",unit:"%",apiField:"relative_humidity_2m"},{id:"precipitation",label:"Precipitation",unit:"mm",apiField:"precipitation"},{id:"wind_speed_10m",label:"Wind Speed (10m)",unit:"km/h",apiField:"wind_speed_10m"}];var d=()=>{let{isDrawing:e,setIsDrawing:t}=(0,s.Z)();return(0,a.jsx)("div",{className:"w-80 bg-white border-r border-gray-200 h-full overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Polygon Controls"}),(0,a.jsxs)("button",{onClick:()=>{t(!0)},disabled:e,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors ".concat(e?"bg-green-100 text-green-700 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:[(0,a.jsx)(n.Z,{size:16}),e?"Drawing Mode Active":"Start Drawing Polygon"]}),e&&(0,a.jsxs)("div",{className:"mt-3 text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:[(0,a.jsx)("p",{className:"font-medium mb-2",children:"\uD83D\uDCCD Drawing Instructions:"}),(0,a.jsxs)("ul",{className:"text-xs space-y-1",children:[(0,a.jsx)("li",{children:"• Click on the map to add vertices"}),(0,a.jsx)("li",{children:"• Double-click to complete the polygon"}),(0,a.jsx)("li",{children:"• Need at least 3 vertices"}),(0,a.jsx)("li",{children:"• Configure data source after creation"})]})]}),(0,a.jsxs)("div",{className:"mt-6 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCA1 Quick Tips:"}),(0,a.jsxs)("ul",{className:"text-xs text-gray-600 space-y-1",children:[(0,a.jsx)("li",{children:"• Use the search above to find polygons"}),(0,a.jsx)("li",{children:"• Click the color button to customize colors"}),(0,a.jsx)("li",{children:"• Click the eye button to highlight on map"}),(0,a.jsx)("li",{children:"• Weather data updates automatically"})]})]})]})})},c=l(4697),g=l(9354);function u(e){let{isOpen:t,onClose:l,onConfirm:r,coordinates:n,inline:d=!1}=e,[u,m]=(0,o.useState)(i[0].apiField),[h,x]=(0,o.useState)(""),[p,y]=(0,o.useState)(!1),f=(0,s.Z)(e=>e.fetchWeatherDataForPolygon),b=async()=>{if(!h.trim()){alert("Please enter a label for the polygon");return}if(!p){y(!0);try{let e={id:(0,g.Ox)(),coordinates:n,label:h.trim(),dataSource:u,colorRules:(0,g.VS)()};r(e),console.log("Fetching weather data for new polygon:",e.id),await f(e.id),x(""),m(i[0].apiField),l()}catch(e){console.error("Error creating polygon or fetching weather data:",e),alert("Failed to fetch weather data. The polygon was created but weather data could not be loaded.")}finally{y(!1)}}},v=()=>{x(""),m(i[0].apiField),l()};return t?d?(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Configure New Polygon"}),(0,a.jsx)("button",{onClick:v,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(c.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Polygon Label"}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>x(e.target.value),placeholder:"Enter polygon name...",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Source"}),(0,a.jsx)("select",{value:u,onChange:e=>m(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:i.map(e=>(0,a.jsxs)("option",{value:e.apiField,children:[e.label," (",e.unit,")"]},e.id))})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:v,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:b,disabled:p,className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Creating & Loading Data...":"Create Polygon"})]})]})]})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 max-w-90vw",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Configure New Polygon"}),(0,a.jsx)("button",{onClick:v,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(c.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Polygon Label"}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>x(e.target.value),placeholder:"Enter polygon name...",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Source"}),(0,a.jsx)("select",{value:u,onChange:e=>m(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:i.map(e=>(0,a.jsxs)("option",{value:e.apiField,children:[e.label," (",e.unit,")"]},e.id))})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Default Color Rules"}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-red-500 rounded"}),(0,a.jsx)("span",{children:"< 10 → Red"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded"}),(0,a.jsx)("span",{children:"≥ 10 and < 25 → Blue"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-green-500 rounded"}),(0,a.jsx)("span",{children:"≥ 25 → Green"})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"You can customize these rules after creating the polygon."})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Vertices:"})," ",n.length]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Area:"})," Polygon with ",n.length," points"]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{onClick:v,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:b,disabled:p,className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Creating & Loading Data...":"Create Polygon"})]})]})}):null}var m=l(6293),h=l(7739),x=l(2705),p=l(9660),y=l(3288),f=l(9332),b=l(7552),v=l(6077),j=l(7834),w=l(9789),N=l(3098),C=l(9707);let{Search:P}=m.default;var D=()=>{let{polygons:e,setPolygonCustomColor:t,clearPolygonCustomColor:l,highlightPolygon:r,clearAllHighlights:n,findPolygonsByLabel:i,deletePolygon:d}=(0,s.Z)(),[c,g]=(0,o.useState)(""),[u,m]=(0,o.useState)([]),D=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA","#F1948A","#85C1E9","#D7BDE2"],k=(e,l)=>{t(e,l),h.ZP.success("Color applied to polygon")},T=e=>{l(e),h.ZP.success("Custom color cleared")},_=e=>{r(e),h.ZP.success("Polygon highlighted on map")},S=e=>{let{polygonId:t,currentColor:l}=e;return(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsx)("div",{className:"text-sm font-medium mb-2",children:"Choose Color:"}),(0,a.jsx)("div",{className:"grid grid-cols-5 gap-2 mb-3",children:D.map(e=>(0,a.jsx)("button",{className:"w-8 h-8 rounded border-2 hover:scale-110 transition-transform ".concat(l===e?"border-gray-800":"border-gray-300"),style:{backgroundColor:e},onClick:()=>k(t,e),title:e},e))}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"color",className:"w-full h-8 rounded border cursor-pointer",onChange:e=>k(t,e.target.value),title:"Custom color picker"}),(0,a.jsx)(x.ZP,{size:"small",onClick:()=>T(t),title:"Clear custom color",children:"Clear"})]})]})};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Polygon Manager"}),(0,a.jsx)(x.ZP,{size:"small",onClick:n,icon:(0,a.jsx)(v.Z,{}),title:"Clear all highlights",children:"Clear Highlights"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)(P,{placeholder:"Search polygons by name...",allowClear:!0,enterButton:(0,a.jsx)(j.Z,{}),size:"large",onSearch:e=>{if(g(e),e.trim()){let t=i(e);m(t.map(e=>e.id)),t.length>0?(h.ZP.success("Found ".concat(t.length," polygon(s)")),r(t[0].id)):(h.ZP.info("No polygons found"),n())}else m([]),n()},onChange:e=>{e.target.value||(g(""),m([]),n())}}),u.length>0&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["Found ",u.length,' polygon(s) matching "',c,'"']})]}),(0,a.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===e.length?(0,a.jsx)("div",{className:"text-center text-gray-500 py-8",children:"No polygons created yet. Draw some polygons on the map!"}):e.map(e=>(0,a.jsx)(p.Z,{size:"small",className:"transition-all duration-200 ".concat(e.isHighlighted?"ring-2 ring-yellow-400 bg-yellow-50":u.includes(e.id)?"ring-2 ring-blue-400 bg-blue-50":"hover:shadow-md"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded border border-gray-300",style:{backgroundColor:e.customColor||e.currentColor||"#808080"}}),(0,a.jsx)("span",{className:"font-medium",children:e.label}),e.customColor&&(0,a.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-1 rounded",children:"Custom"}),e.isHighlighted&&(0,a.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-1 rounded",children:"\uD83D\uDCCD Found"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Source: ",e.dataSource," • ",e.coordinates.length," points"]})]}),(0,a.jsxs)(y.Z,{children:[(0,a.jsx)(f.Z,{content:(0,a.jsx)(S,{polygonId:e.id,currentColor:e.customColor}),title:"Polygon Color",trigger:"click",placement:"left",children:(0,a.jsx)(b.Z,{title:"Change color",children:(0,a.jsx)(x.ZP,{size:"small",icon:(0,a.jsx)(w.Z,{}),type:e.customColor?"primary":"default"})})}),(0,a.jsx)(b.Z,{title:"Find on map",children:(0,a.jsx)(x.ZP,{size:"small",icon:(0,a.jsx)(N.Z,{}),onClick:()=>_(e.id),type:e.isHighlighted?"primary":"default"})}),(0,a.jsx)(b.Z,{title:"Delete polygon",children:(0,a.jsx)(x.ZP,{size:"small",icon:(0,a.jsx)(C.Z,{}),danger:!0,onClick:()=>{d(e.id),h.ZP.success("Polygon deleted")}})})]})]})},e.id))}),e.length>0&&(0,a.jsx)("div",{className:"mt-4 pt-3 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600 text-center",children:["Total: ",e.length," polygon(s) •",e.filter(e=>e.customColor).length," with custom colors"]})})]})};let k=(0,r.default)(()=>Promise.all([l.e(858),l.e(887)]).then(l.bind(l,9887)),{loadableGenerated:{webpack:()=>[9887]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Time Control"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Loading..."})]})})})}),T=(0,r.default)(()=>Promise.all([l.e(733),l.e(212),l.e(991)]).then(l.bind(l,3991)),{loadableGenerated:{webpack:()=>[3991]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"flex items-center justify-center h-full bg-gray-100",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading map..."})})});function _(){let{addPolygon:e}=(0,s.Z)(),[t,l]=(0,o.useState)(!1),[r,n]=(0,o.useState)([]),i=(0,o.useRef)(null);return(0,o.useEffect)(()=>{t&&i.current&&setTimeout(()=>{var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},[t]),(0,a.jsxs)("div",{className:"h-screen flex flex-col",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Weather Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Interactive weather data visualization with polygon mapping"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:()=>{console.log("Test modal triggered"),n([{lat:51.505,lng:-.09},{lat:51.51,lng:-.1},{lat:51.51,lng:-.08}]),l(!0)},className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600",children:"Test Modal"})})]})}),(0,a.jsx)(k,{}),t&&(0,a.jsx)("div",{ref:i,className:"bg-blue-50 border-b-2 border-blue-200 px-6 py-4 shadow-sm",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)("div",{className:"mb-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"Polygon Configuration Active"})]})}),(0,a.jsx)(u,{isOpen:t,onClose:()=>{l(!1),n([])},onConfirm:t=>{e(t),n([])},coordinates:r,inline:!0})]})}),(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsx)("div",{className:"w-80 flex flex-col bg-gray-50 border-r border-gray-200 overflow-hidden",children:(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,a.jsx)(D,{}),(0,a.jsx)(d,{})]})}),(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)(T,{onPolygonCreate:e=>{if(console.log("handlePolygonCreate called with coordinates:",e),e.length<3){alert("Polygon must have at least 3 vertices");return}if(e.length>12){alert("Polygon cannot have more than 12 vertices");return}console.log("Setting modal open and pending coordinates"),n(e),l(!0)}})})]})]})}},9354:function(e,t,l){"use strict";l.d(t,{Ox:function(){return a},VS:function(){return r},o0:function(){return o}});let a=()=>Math.random().toString(36).substr(2,9),o=e=>{try{let t=e.getFullYear(),l=e.toLocaleString("en-US",{month:"short"}),a=e.getDate().toString().padStart(2,"0"),o=e.getHours().toString().padStart(2,"0"),r=e.getMinutes().toString().padStart(2,"0");return"".concat(l," ").concat(a,", ").concat(t,", ").concat(o,":").concat(r)}catch(e){return console.error("Error formatting date:",e),"Invalid Date"}},r=()=>[{id:a(),operator:"<",value:10,color:"#ef4444"},{id:a(),operator:">=",value:10,color:"#3b82f6"},{id:a(),operator:">=",value:25,color:"#22c55e"}]},6129:function(e,t,l){"use strict";l.d(t,{Z:function(){return g}});var a=l(9099),o=l(9291),r=l(508),n=l(8346);async function s(e){let{latitude:t,longitude:l,startDate:a,endDate:o,hourlyParams:r}=e,n=new URLSearchParams({latitude:t.toString(),longitude:l.toString(),start_date:a,end_date:o,hourly:r.join(","),timezone:"UTC"}),s="".concat("https://archive-api.open-meteo.com/v1/archive","?").concat(n.toString());try{console.log("Fetching weather data from:",s);let e=await fetch(s);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json(),l={latitude:t.latitude,longitude:t.longitude,hourly:{time:t.hourly.time,temperature_2m:t.hourly.temperature_2m||[],relative_humidity_2m:t.hourly.relative_humidity_2m,precipitation:t.hourly.precipitation,wind_speed_10m:t.hourly.wind_speed_10m}};return console.log("Weather data fetched successfully:",l),l}catch(e){throw console.error("Error fetching weather data:",e),Error("Failed to fetch weather data: ".concat(e instanceof Error?e.message:"Unknown error"))}}async function i(e,t,l,a){if(!e||!Array.isArray(e))throw Error("Invalid coordinates: must be an array");if(!t||"string"!=typeof t)throw Error("Invalid data source: must be a non-empty string");if(!l||!a)throw Error("Invalid date range: start and end dates are required");let o=d(e),r=[t];return"temperature_2m"===t&&r.push("relative_humidity_2m"),s({latitude:o.lat,longitude:o.lng,startDate:l,endDate:a,hourlyParams:r})}function d(e){if(0===e.length)return console.warn("Empty polygon coordinates, using default center point"),{lat:0,lng:0};let t=0,l=0;for(let a of e){if("number"!=typeof a.lat||"number"!=typeof a.lng||isNaN(a.lat)||isNaN(a.lng)){console.warn("Invalid coordinate found, skipping:",a);continue}t+=a.lat,l+=a.lng}let a=e.filter(e=>"number"==typeof e.lat&&"number"==typeof e.lng&&!isNaN(e.lat)&&!isNaN(e.lng));return 0===a.length?(console.warn("No valid coordinates found, using default center point"),{lat:0,lng:0}):{lat:t/a.length,lng:l/a.length}}function c(e,t,l,a){e&&Array.isArray(e)||(console.warn("Invalid coordinates for cache key, using default"),e=[]);let o=d(e);return"".concat(o.lat.toFixed(4),"_").concat(o.lng.toFixed(4),"_").concat(t,"_").concat(l,"_").concat(a)}var g=(0,a.Ue)()((0,o.tJ)((e,t)=>({polygons:[],selectedTimeRange:{start:(0,r.Z)(new Date,-15),end:(0,r.Z)(new Date,15)},currentTime:new Date,dataCache:{},isDrawing:!1,selectedPolygon:null,sliderMode:{type:"single",singleValue:360},mapCenter:{lat:51.505,lng:-.09},mapZoom:10,addPolygon:t=>{e(e=>({polygons:[...e.polygons,t]}))},updatePolygon:(t,l)=>{e(e=>({polygons:e.polygons.map(e=>e.id===t?{...e,...l}:e)}))},deletePolygon:t=>{e(e=>({polygons:e.polygons.filter(e=>e.id!==t),selectedPolygon:e.selectedPolygon===t?null:e.selectedPolygon}))},setTimeRange:t=>{e({selectedTimeRange:t})},setCurrentTime:t=>{e({currentTime:t})},setIsDrawing:t=>{e({isDrawing:t})},setSelectedPolygon:t=>{e({selectedPolygon:t})},setSliderMode:t=>{e({sliderMode:t})},setMapCenter:t=>{e({mapCenter:t})},setMapZoom:t=>{e({mapZoom:t})},cacheWeatherData:(t,l)=>{e(e=>({dataCache:{...e.dataCache,[t]:l}}))},fetchWeatherDataForPolygon:async e=>{let l=t(),a=l.polygons.find(t=>t.id===e);if(!a){console.error("Polygon not found:",e);return}let o=l.selectedTimeRange.start instanceof Date?l.selectedTimeRange.start:new Date(l.selectedTimeRange.start),r=l.selectedTimeRange.end instanceof Date?l.selectedTimeRange.end:new Date(l.selectedTimeRange.end);if(!l.selectedTimeRange.start||!l.selectedTimeRange.end||isNaN(o.getTime())||isNaN(r.getTime())){console.warn("Invalid time range in fetchWeatherDataForPolygon, skipping fetch");return}let s=(0,n.Z)(o,"yyyy-MM-dd"),d=(0,n.Z)(r,"yyyy-MM-dd"),g=c(a.coordinates,a.dataSource,s,d);if(l.dataCache[g])return console.log("Using cached weather data for polygon:",e),l.dataCache[g];try{console.log("Fetching weather data for polygon:",e);let t=await i(a.coordinates,a.dataSource,s,d);return l.cacheWeatherData(g,t),l.updatePolygonColor(e),t}catch(t){throw console.error("Failed to fetch weather data for polygon:",e,t),t}},updatePolygonColor:e=>{let l=t(),a=l.polygons.find(t=>t.id===e);if(!a)return;let o=l.selectedTimeRange.start instanceof Date?l.selectedTimeRange.start:new Date(l.selectedTimeRange.start),r=l.selectedTimeRange.end instanceof Date?l.selectedTimeRange.end:new Date(l.selectedTimeRange.end);if(!l.selectedTimeRange.start||!l.selectedTimeRange.end||isNaN(o.getTime())||isNaN(r.getTime())){console.warn("Invalid time range in updatePolygonColor, skipping update");return}let s=(0,n.Z)(o,"yyyy-MM-dd"),i=(0,n.Z)(r,"yyyy-MM-dd"),d=c(a.coordinates,a.dataSource,s,i),g=l.dataCache[d];if(!g)return;let u=l.currentTime instanceof Date?l.currentTime:new Date(l.currentTime);if(!l.currentTime||isNaN(u.getTime())){console.warn("Invalid current time in updatePolygonColor, skipping update");return}let m=function(e,t,l){var a,o,r,n,s,i,d;let{hourly:c}=e;l.toISOString();let g=0,u=1/0;for(let e=0;e<c.time.length;e++){let t=Math.abs(new Date(c.time[e]).getTime()-l.getTime());t<u&&(u=t,g=e)}switch(t){case"temperature_2m":return null!==(a=c.temperature_2m[g])&&void 0!==a?a:null;case"relative_humidity_2m":return null!==(r=null===(o=c.relative_humidity_2m)||void 0===o?void 0:o[g])&&void 0!==r?r:null;case"precipitation":return null!==(s=null===(n=c.precipitation)||void 0===n?void 0:n[g])&&void 0!==s?s:null;case"wind_speed_10m":return null!==(d=null===(i=c.wind_speed_10m)||void 0===i?void 0:i[g])&&void 0!==d?d:null;default:return null}}(g,a.dataSource,u);if(null===m)return;let h="#gray-400";for(let e of a.colorRules){let t=!1;switch(e.operator){case"<":t=m<e.value;break;case"<=":t=m<=e.value;break;case">":t=m>e.value;break;case">=":t=m>=e.value;break;case"=":t=.1>Math.abs(m-e.value);break;case"!=":t=Math.abs(m-e.value)>=.1}if(t){h=e.color;break}}a.customColor||l.updatePolygon(e,{currentColor:h})},fetchAllPolygonsWeatherData:async()=>{let e=t(),l=e.polygons.map(t=>e.fetchWeatherDataForPolygon(t.id).catch(e=>(console.error("Failed to fetch data for polygon ".concat(t.id,":"),e),null)));await Promise.all(l)},updateAllPolygonColors:()=>{let e=t();e.polygons.forEach(t=>{e.updatePolygonColor(t.id)})},setPolygonCustomColor:(t,l)=>{e(e=>({polygons:e.polygons.map(e=>e.id===t?{...e,customColor:l,currentColor:l}:e)}))},clearPolygonCustomColor:l=>{e(e=>({polygons:e.polygons.map(e=>e.id===l?{...e,customColor:void 0}:e)})),t().updatePolygonColor(l)},highlightPolygon:t=>{e(e=>({polygons:e.polygons.map(e=>e.id===t?{...e,isHighlighted:!0}:{...e,isHighlighted:!1})}))},clearAllHighlights:()=>{e(e=>({polygons:e.polygons.map(e=>({...e,isHighlighted:!1}))}))},findPolygonsByLabel:e=>t().polygons.filter(t=>t.label.toLowerCase().includes(e.toLowerCase()))}),{name:"weather-dashboard-storage",storage:(0,o.FL)(()=>localStorage),partialize:e=>({polygons:e.polygons,selectedTimeRange:e.selectedTimeRange,currentTime:e.currentTime})}))}},function(e){e.O(0,[993,971,23,744],function(){return e(e.s=3685)}),_N_E=e.O()}]);