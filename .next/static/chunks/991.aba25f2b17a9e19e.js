(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[991],{3991:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return q}});var r,l,o,a,i,c,u,s,f=n(7437),d=n(2265),p=n(7818);let h=(0,d.createContext)(null),m=h.Provider;function g(){let e=(0,d.useContext)(h);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function v(e){let t=g().map;return(0,d.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}var x=n(4887);function y(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function w(e,t){return null==t?function(t,n){let r=(0,d.useRef)();return r.current||(r.current=e(t,n)),r}:function(n,r){let l=(0,d.useRef)();l.current||(l.current=e(n,r));let o=(0,d.useRef)(n),{instance:a}=l.current;return(0,d.useEffect)(function(){o.current!==n&&(t(a,n,o.current),o.current=n)},[a,n,r]),l}}function b(e,t){let n=(0,d.useRef)(t);(0,d.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function j(e,t){let n=(0,d.useRef)();(0,d.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function C(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function k(e,t){(0,d.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}var E=n(7691),P=n.n(E);let Z=(r=w(function({positions:e,...t},n){var r;let l=new E.Polygon(e,t);return y(l,(r={overlayContainer:l},Object.freeze({...n,...r})))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)}),l=function(e){let t=g(),n=r(C(e,t),t);return j(n.current,e.eventHandlers),k(n.current,t),function(e,t){let n=(0,d.useRef)();(0,d.useEffect)(function(){if(t.pathOptions!==n.current){let r=t.pathOptions??{};e.instance.setStyle(r),n.current=r}},[e,t])}(n.current,e),n},(0,d.forwardRef)(function(e,t){let{instance:n,context:r}=l(e).current;return(0,d.useImperativeHandle)(t,()=>n),null==e.children?null:d.createElement(m,{value:r},e.children)}));function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let D=(0,d.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:r,className:l,id:o,placeholder:a,style:i,whenReady:c,zoom:u,...s},f){let[p]=(0,d.useState)({className:l,id:o,style:i}),[h,g]=(0,d.useState)(null);(0,d.useImperativeHandle)(f,()=>h?.map??null,[h]);let v=(0,d.useCallback)(r=>{if(null!==r&&null===h){let l=new E.Map(r,s);null!=n&&null!=u?l.setView(n,u):null!=e&&l.fitBounds(e,t),null!=c&&l.whenReady(c),g(Object.freeze({__version:1,map:l}))}},[]);(0,d.useEffect)(()=>()=>{h?.map.remove()},[h]);let x=h?d.createElement(m,{value:h},r):a??null;return d.createElement("div",N({},p,{ref:v}),x)}),O=(o=w(function({url:e,...t},n){return y(new E.TileLayer(e,C(t,n)),n)},function(e,t,n){!function(e,t,n){let{opacity:r,zIndex:l}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=l&&l!==n.zIndex&&e.setZIndex(l)}(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)}),a=function(e){let t=g(),n=o(C(e,t),t);return b(t.map,e.attribution),j(n.current,e.eventHandlers),k(n.current,t),n},(0,d.forwardRef)(function(e,t){let{instance:n}=a(e).current;return(0,d.useImperativeHandle)(t,()=>n),null})),R=(i=function(e,t){return y(new E.Tooltip(e,t.overlayContainer),t)},c=function(e,t,{position:n},r){(0,d.useEffect)(function(){let l=t.overlayContainer;if(null==l)return;let{instance:o}=e,a=e=>{e.tooltip===o&&(null!=n&&o.setLatLng(n),o.update(),r(!0))},i=e=>{e.tooltip===o&&r(!1)};return l.on({tooltipopen:a,tooltipclose:i}),l.bindTooltip(o),function(){l.off({tooltipopen:a,tooltipclose:i}),null!=l._map&&l.unbindTooltip()}},[e,t,r,n])},u=w(i),s=function(e,t){let n=g(),r=u(C(e,n),n);return b(n.map,e.attribution),j(r.current,e.eventHandlers),c(r.current,n,e,t),r},(0,d.forwardRef)(function(e,t){let[n,r]=(0,d.useState)(!1),{instance:l}=s(e,r).current;(0,d.useImperativeHandle)(t,()=>l),(0,d.useEffect)(function(){n&&l.update()},[l,n,e.children]);let o=l._contentNode;return o?(0,x.createPortal)(e.children,o):null}));var L=n(7739),z=n(2705),S=n(1066);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let H=(0,S.Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),I=(0,S.Z)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var M=n(6129);n(966),delete P().Icon.Default.prototype._getIconUrl,P().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});let _=()=>{let e=g().map,{mapCenter:t,mapZoom:n,setMapCenter:r,setMapZoom:l}=(0,M.Z)();return(0,d.useEffect)(()=>{e&&e.setView([t.lat,t.lng],n)},[e,t,n]),v({moveend:()=>{let t=e.getCenter();r({lat:t.lat,lng:t.lng})},zoomend:()=>{l(e.getZoom())}}),null},A=e=>{let{onPolygonComplete:t}=e,{isDrawing:n,setIsDrawing:r}=(0,M.Z)(),[l,o]=(0,d.useState)([]);return v({click:e=>{if(!n)return;let a=[...l,{lat:e.latlng.lat,lng:e.latlng.lng}];o(a),a.length>=3?L.ZP.info("".concat(a.length," vertices added. Double-click to finish or continue adding (max 12).")):L.ZP.info("".concat(a.length," vertices added. Need at least 3 vertices.")),a.length>=12&&(L.ZP.success("Maximum vertices reached. Polygon completed!"),console.log("Auto-completing polygon with max vertices:",a),t(a),o([]),r(!1))},dblclick:e=>{if(n){if(e.originalEvent.preventDefault(),l.length<3){L.ZP.warning("Need at least 3 vertices to create a polygon!");return}L.ZP.success("Polygon created with ".concat(l.length," vertices!")),console.log("Double-click polygon completion:",l),t(l),o([]),r(!1)}}}),l.length>0?(0,f.jsx)(Z,{positions:l.map(e=>[e.lat,e.lng]),pathOptions:{color:"#1890ff",fillColor:"#1890ff",fillOpacity:.3,weight:3,dashArray:"8, 8"}}):null},U=()=>{let{mapCenter:e,setMapCenter:t,setMapZoom:n,isDrawing:r,setIsDrawing:l}=(0,M.Z)();return(0,f.jsxs)("div",{className:"absolute top-4 right-4 z-[1000] flex flex-col gap-2",children:[(0,f.jsx)(z.ZP,{type:"primary",icon:(0,f.jsx)(H,{size:16}),onClick:r?()=>{l(!1),L.ZP.info("Drawing mode deactivated.")}:()=>{l(!0),L.ZP.info("Drawing mode activated. Click on map to add vertices.")},className:r?"bg-red-500 hover:bg-red-600":"",children:r?"Stop Drawing":"Draw Polygon"}),(0,f.jsx)(z.ZP,{icon:(0,f.jsx)(I,{size:16}),onClick:()=>{t({lat:51.505,lng:-.09}),n(10),L.ZP.info("Map view reset to default")},children:"Reset View"})]})},T=e=>{let{onPolygonCreate:t}=e,{polygons:n,currentTime:r,selectedTimeRange:l,sliderMode:o,mapCenter:a,mapZoom:i,updateAllPolygonColors:c,fetchAllPolygonsWeatherData:u}=(0,M.Z)();return(0,d.useEffect)(()=>{n.length>0&&u().catch(e=>{console.error("Error fetching weather data for polygons:",e)})},[n,l,u]),(0,d.useEffect)(()=>{c()},[r,c]),(0,f.jsxs)("div",{className:"relative h-full w-full",children:[(0,f.jsxs)(D,{center:[a.lat,a.lng],zoom:i,style:{height:"100%",width:"100%"},zoomControl:!0,doubleClickZoom:!1,children:[(0,f.jsx)(O,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,f.jsx)(_,{}),(0,f.jsx)(A,{onPolygonComplete:t}),n.map(e=>{let t=e.customColor||e.currentColor||"#808080",n=e.isHighlighted;return(0,f.jsx)(Z,{positions:e.coordinates.map(e=>[e.lat,e.lng]),pathOptions:{color:t,fillColor:t,fillOpacity:n?.9:.7,weight:n?5:3,opacity:1,dashArray:n?"10, 5":void 0},children:(0,f.jsx)(R,{permanent:!0,children:(0,f.jsxs)("div",{className:"text-sm",children:[(0,f.jsx)("div",{className:"font-semibold",children:e.label}),(0,f.jsxs)("div",{className:"text-gray-600",children:["Source: ",e.dataSource]}),e.customColor&&(0,f.jsx)("div",{className:"text-blue-600 text-xs",children:"\uD83C\uDFA8 Custom Color"}),n&&(0,f.jsx)("div",{className:"text-yellow-600 text-xs font-bold",children:"\uD83D\uDCCD Found"})]})})},e.id)})]}),(0,f.jsx)(U,{})]})};var q=(0,p.default)(()=>Promise.resolve(T),{ssr:!1,loading:()=>(0,f.jsx)("div",{className:"flex items-center justify-center h-full bg-gray-100",children:(0,f.jsx)("div",{className:"text-gray-500",children:"Loading map..."})})})},966:function(){}}]);